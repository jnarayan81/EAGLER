CXX=g++
SRC_DIR=../src
OBJ_DIR=obj

CXX_FLAGS+=-std=c++11
CXX_FLAGS+=-I../vendor/seqan/include
CXX_FLAGS+=-I../lib
CXX_FLAGS+=-W -Wall -Wno-long-long -pedantic -Wno-variadic-macros
LD_FLAGS=

H_FILES = $(wildcard $(SRC_DIR)/*.h)
CPP_FILES := $(wildcard $(SRC_DIR)/*.cpp)
OBJ_FILES := $(addprefix $(OBJ_DIR)/,$(notdir $(CPP_FILES:.cpp=.o)))

UNAME_S := $(shell uname -s)

ifeq ($(UNAME_S),Linux)
	LD_FLAGS+=-lrt
endif
ifeq ($(UNAME_S),Darwin)
	# hack to avoid selecting old system g++
	CXX=g++-4.9
endif

default: all
all: $(OBJ_FILES) main

main: $(OBJ_FILES)
	$(CXX) $(LD_FLAGS) -o $@ $^

$(OBJ_DIR)/%.o: $(SRC_DIR)/%.cpp
	$(CXX) $(CXX_FLAGS) -c -o $@ $<

$(OBJ_DIR):
	mkdir -p $(OBJ_DIR)

$(OBJ_FILES): | $(OBJ_DIR)

clean:
	rm -rf obj/
	rm -f main

.PHONY: default all clean
